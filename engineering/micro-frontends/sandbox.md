# 沙箱

## 前言

当多个子应用独立运行时，每个应用都会有自己的运行环境，当这些应用在 **宿主应用** 里运行时，如何避免应用的环境被 **宿主应用** 影响，或者影响  **宿主应用**，即 **应用间运行时如何隔离**，比如说JS隔离，CSS隔离。

常见的方案有下面这些

- 基于 iframe + 消息通信的实现
- 基于 Proxy 快照存储 + window 修改的实现
- 基于 Proxy 代理拦截 + window 激活/卸载的实现
- 基于普通对象快照存储的 window 属性 diff 实现
- 基于 ShadowRealm 提案的实现
- 基于 with + eval 的简单实现

## 为什么不是 iframe

:::tip [引用 Why Not Iframe](https://www.yuque.com/kuitos/gky7yw/gesexv)
iframe 最大的特性就是提供了浏览器原生的硬隔离方案，不论是样式隔离、js 隔离这类问题统统都能被完美解决。但他的最大问题也在于他的隔离性无法被突破，导致应用间上下文无法被共享，随之带来的开发体验、产品体验的问题。

1. url 不同步。浏览器刷新 iframe url 状态丢失、后退前进按钮无法使用。**(好解决)**
2. UI 不同步，DOM 结构不共享。想象一下屏幕右下角 1/4 的 iframe 里来一个带遮罩层的弹框，同时我们要求这个弹框要浏览器居中显示，还要浏览器 resize 时自动居中。 **(难以解决)**
3. 全局上下文完全隔离，内存变量不共享。iframe 内外系统的通信、数据同步等需求，主应用的 cookie 要透传到根域名都不同的子应用中实现免登效果。**(难以解决)**
4. 慢。每次子应用进入都是一次浏览器上下文重建、资源重新加载的过程，加载优化、运行优化问题 **(好解决)**
:::


## 定义

又称为 sandbox, 指一个允许你独立运行程序的虚拟环境。sandbox 可以隔离当前执行环境作用域和外部其他作用域，环境之间相互独立，互不影响。

## 沙盒的优势

- 开发者体验不到环境的区别
- 运行没有环境差异

## 怎么实现

???

## 分类

### 快照沙箱

### Proxy(代理)沙箱

